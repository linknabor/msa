<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eshequ.msa.crm.mapper.repairmng.RepairOrderMapper">
  <resultMap id="BaseResultMap" type="com.eshequ.msa.crm.model.repairmng.RepairOrder">
    <id column="REPAIR_ID" jdbcType="VARCHAR" property="repairId" />
    <result column="REPAIR_TYPE" jdbcType="CHAR" property="repairType" />
    <result column="REPAIR_ADDRESS" jdbcType="VARCHAR" property="repairAddress" />
    <result column="REPAIR_CONTENT" jdbcType="VARCHAR" property="repairContent" />
    <result column="REPAIR_PHONE" jdbcType="VARCHAR" property="repairPhone" />
    <result column="REPAIR_DATE" jdbcType="TIMESTAMP" property="repairDate" />
    <result column="REPAIR_PEPOLE_ID" jdbcType="VARCHAR" property="repairPepoleId" />
    <result column="REPAIR_PEPOLE_NAME" jdbcType="VARCHAR" property="repairPepoleName" />
    <result column="REPAIR_PEPOLE_IMG" jdbcType="VARCHAR" property="repairPepoleImg" />
    <result column="REPAIR_STATUS" jdbcType="CHAR" property="repairStatus" />
    <result column="REPAIR_CLOSE_RESION" jdbcType="VARCHAR" property="repairCloseResion" />
    <result column="REPAIR_ASSIGN_ID" jdbcType="VARCHAR" property="repairAssignId" />
    <result column="IS_LOOK" jdbcType="VARCHAR" property="isLook" />
    <result column="SERVER_IDS" jdbcType="VARCHAR" property="serverIds" />
  </resultMap>
  
  <select id="getRepairOrderList" parameterType="java.lang.String" resultMap="BaseResultMap">
  SELECT REPAIR_ID,REPAIR_ADDRESS,REPAIR_DATE,REPAIR_PEPOLE_NAME,REPAIR_PEPOLE_IMG,IS_LOOK FROM REPAIR_ORDER 
  <where>
  <if test="userId != null">
  AND REPAIR_ASSIGN_ID=#{userId}
  </if>
  </where>
  ORDER BY REPAIR_DATE DESC
  </select>
  <select id="findRepairOrderById" parameterType="java.lang.String" resultMap="BaseResultMap">
  SELECT REPAIR_ID,REPAIR_TYPE,REPAIR_ADDRESS,REPAIR_CONTENT,REPAIR_DATE,REPAIR_STATUS,REPAIR_PHONE,REPAIR_ASSIGN_ID,IS_LOOK FROM REPAIR_ORDER
  WHERE  REPAIR_ID = #{repairId}
  </select>
  
  <select id="getNotLookOrderCount" parameterType="java.lang.String" resultType="java.lang.Integer">
  SELECT COUNT(REPAIR_ID) FROM REPAIR_ORDER
  <where>
     IS_LOOK = 0
  <if test="userId != null">
  AND REPAIR_ASSIGN_ID=#{userId}
  
  OR IS_LOOK = 1
  </if>
  
  <if test="userId == null">
  OR IS_LOOK = 2
  </if>
  
  </where>
  </select>
  
  
  <select id="getMaxTime" resultType="java.lang.String">
  select max(REPAIR_DATE) REPAIR_DATE FROM REPAIR_ORDER
  </select>
  
  <update id="updateIsLook" parameterType="java.lang.String">
  UPDATE REPAIR_ORDER  SET
  <if test="userId != null">
   IS_LOOK = 2
   
   WHERE REPAIR_ASSIGN_ID=#{userId} AND IS_LOOK = 0 OR  IS_LOOK = 1
  </if>
  <if test="userId == null">
  IS_LOOK = 1
  
  WHERE IS_LOOK =0 OR IS_LOOK =2
  </if>
  </update>
  
  <update id="updateIsLookById" parameterType="java.lang.String">
  UPDATE REPAIR_ORDER
  <set>
   <if test="userId != null">
   IS_LOOK = 2
  </if>
  <if test="userId == null">
  IS_LOOK = 1
  </if>
  </set>
  WHERE REPAIR_ID = #{repairId}
  </update>
</mapper>